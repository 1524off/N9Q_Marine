<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>é›†çµæ™‚é–“è¨ˆç®—æ©Ÿï¼ˆ1524 Off_Marineï¼‰</title>
<link rel="icon" href="icon-1524.png">
<link rel="apple-touch-icon" href="icon-1524.png">
<meta name="theme-color" content="#1565C0">

<style>
:root{
  --navy:#1565C0;
  --bg:#f8faff;
  --text:#1f2937;
  --line:#d1d5db;
}
body{
  margin:0;background:var(--bg);color:var(--text);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans JP",sans-serif;
}
header{text-align:center;padding:16px 0 8px;}
.clock{
  background:#eef3fb;color:var(--navy);
  display:inline-block;padding:12px 20px;border-radius:10px;
  font-size:1.6rem;font-weight:700;font-variant-numeric:tabular-nums;
}
main{max-width:860px;margin:0 auto;padding:10px;}
.card{
  background:#fff;border:1px solid var(--line);border-radius:12px;
  padding:14px;margin:10px 0;box-shadow:0 1px 2px rgba(0,0,0,.02);
}

/* ãƒœã‚¿ãƒ³ */
.small-btn{
  width:32px;height:32px;border-radius:50%;
  font-size:18px;font-weight:600;
  border:1px solid #d1d5db;background:#f9fafb;color:#4b5563;
}
#calcBtn{
  width:100%;background:var(--navy);color:#fff;
  font-size:18px;font-weight:700;border:none;border-radius:10px;
  padding:14px 0;margin-top:12px;
  box-shadow:0 3px 8px rgba(21,101,192,0.3);
}

/* ãƒ†ãƒ¼ãƒ–ãƒ« */
table{width:100%;border-collapse:collapse;}
th,td{border:1px solid var(--line);padding:8px;text-align:center;font-size:14px;}
th{background:#f0f4ff;color:#1e3a8a;font-weight:600;}
tbody tr:nth-child(odd){background:#fafbff;}

/* ãƒšãƒƒãƒˆåˆ—éè¡¨ç¤º */
.hide-pet th:nth-child(1), .hide-pet th:nth-child(5),
.hide-pet td:nth-child(1), .hide-pet td:nth-child(5){
  display:none;
}

/* ãƒšãƒƒãƒˆçŠ¶æ…‹ */
.pet-status .time{font-size:12px;color:#1565C0;margin-left:4px;opacity:.85;}
tr.pet-active-row{
  background:linear-gradient(90deg,#eaf2ff 0%,#d9e8ff 100%);
  box-shadow:inset 0 0 0 2px #1565C0;
}
tr.pet-expired-row{background:#f5f5f5;color:#9ca3af;}

/* å…±é€šç€å¼¾å¼·èª¿ */
#impactDisplay{text-align:center;margin-top:10px;}
#impactDisplay #commonImpact{
  font-size:1.8rem;font-weight:700;color:#1565C0;
  background:linear-gradient(90deg,#eaf2ff 0%,#d9e8ff 100%);
  border-radius:10px;padding:8px 0;
  box-shadow:0 1px 3px rgba(21,101,192,0.2);
}
</style>
</head>
<body>
<header><div class="clock" id="utcClock">UTC --:--:--</div></header>
<main>

<!-- ãƒ¢ãƒ¼ãƒ‰ï¼†æ™‚é–“è¨­å®š -->
<section class="card" style="text-align:center;">
  <div style="display:flex;align-items:center;gap:8px;justify-content:center;flex-wrap:wrap;">
    <div style="display:flex;gap:4px;">
      <button id="addBtn" class="small-btn">ï¼‹</button>
      <button id="removeBtn" class="small-btn">âˆ’</button>
    </div>
    <span>ãƒ¢ãƒ¼ãƒ‰ï¼š</span>
    <select id="mode" style="padding:6px 8px;border:1px solid #d1d5db;border-radius:8px;">
      <option value="normal" selected>è¢«ã›é›†çµãƒ¢ãƒ¼ãƒ‰</option>
      <option value="reverse">ç€æ™‚é–“æŒ‡å®šãƒ¢ãƒ¼ãƒ‰</option>
    </select>
  </div>

  <div style="display:flex;justify-content:center;gap:12px;margin-top:8px;flex-wrap:wrap;">
    <div>
      <label>æº–å‚™</label>
      <select id="prep" style="padding:6px 8px;border:1px solid #d1d5db;border-radius:8px;width:90px;">
        <option value="30" selected>30ç§’</option>
        <option value="60">60ç§’</option>
        <option value="90">90ç§’</option>
        <option value="120">120ç§’</option>
      </select>
    </div>
    <div>
      <label>é›†çµ</label>
      <select id="rally" style="padding:6px 8px;border:1px solid #d1d5db;border-radius:8px;width:90px;">
        <option value="5" selected>5åˆ†</option>
        <option value="10">10åˆ†</option>
        <option value="15">15åˆ†</option>
      </select>
    </div>
  </div>

  <div id="impactBox" style="margin-top:8px;display:none;">
    <label style="font-size:13px;color:#6b7280;">å…±é€šç€å¼¾æ™‚åˆ»ï¼ˆUTCï¼‰</label><br>
    <input type="time" id="impactTime" step="1" value="12:10:00"
           style="padding:6px 8px;border:1px solid #d1d5db;border-radius:8px;">
  </div>

  <button id="calcBtn">è¨ˆç®—ã™ã‚‹</button>
</section>

<!-- ãƒšãƒƒãƒˆã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤ºåˆ‡æ›¿ -->
<div style="text-align:right;margin:4px 0 0 0;">
  <label style="font-size:14px;color:#374151;">
    <input type="checkbox" id="togglePet" checked> ãƒšãƒƒãƒˆã‚¿ã‚¤ãƒãƒ¼ã‚’è¡¨ç¤º
  </label>
</div>

<!-- ãƒ†ãƒ¼ãƒ–ãƒ« -->
<section class="card">
  <table id="tbl">
    <thead>
      <tr>
        <th>ğŸ¶</th><th>é›†çµä¸»</th><th>è¡Œè»</th><th>å‡ºç™ºï¼ˆUTCï¼‰</th><th>ãƒšãƒƒãƒˆ</th>
      </tr>
    </thead>
    <tbody id="tbody">
      <tr>
        <td><input type="checkbox" class="pet"></td>
        <td><input type="text" placeholder="ä¾‹ï¼šMarine"></td>
        <td><select class="march" id="marchSelect"></select></td>
        <td>-</td>
        <td class="pet-status pet-inactive">âšª â€•</td>
      </tr>
    </tbody>
  </table>

  <div id="impactDisplay">
    <div style="font-size:14px;color:#6b7280;">ğŸ•’ å…±é€šç€å¼¾ï¼ˆUTCï¼‰</div>
    <div id="commonImpact">--:--:--</div>
  </div>
</section>

<!-- ã‚³ãƒ”ãƒ¼ -->
<section class="card">
  <label>ã‚³ãƒ”ãƒ¼ç”¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</label>
  <div id="copyBox" style="white-space:pre-wrap;font-family:ui-monospace,Menlo,monospace;background:#fff;border:1px solid var(--line);border-radius:10px;padding:10px;min-height:70px;">ï¼ˆè¨ˆç®—ã™ã‚‹ã¨ã“ã“ã«æ•´å½¢ãƒ†ã‚­ã‚¹ãƒˆãŒå‡ºã¾ã™ï¼‰</div>
  <div style="margin-top:8px;">
    <button id="copyBtn" style="padding:10px 14px;border:1px solid var(--line);background:#f9fafb;border-radius:8px">ã‚³ãƒ”ãƒ¼</button>
  </div>
</section>

<footer style="text-align:center;color:#9ca3af;font-size:12px;padding:10px 0 20px;">
  Â© 1524 Off_Marine â€” é›†çµæ™‚é–“è¨ˆç®—æ©Ÿ
</footer>
</main>

<script>
const pad = n=>String(n).padStart(2,'0');
const fmtUTC = d=>`${pad(d.getUTCHours())}:${pad(d.getUTCMinutes())}:${pad(d.getUTCSeconds())}`;
const nowUTC = ()=>new Date();
function tickClock(){document.getElementById('utcClock').textContent=`UTC ${fmtUTC(nowUTC())}`;}
setInterval(tickClock,1000);tickClock();

// è¡Œè»ãƒªã‚¹ãƒˆç”Ÿæˆ
document.addEventListener("DOMContentLoaded",()=>{
  const marchSelect=document.getElementById('marchSelect');
  for(let sec=13;sec<=180;sec++){
    const min=Math.floor(sec/60),s=sec%60;
    const opt=document.createElement('option');
    opt.value=sec;opt.textContent=`${min}åˆ†${pad(s)}ç§’`;
    marchSelect.appendChild(opt);
  }
});

// ãƒšãƒƒãƒˆã‚¿ã‚¤ãƒãƒ¼
const PET_DURATION_MS=2*60*60*1000;
function setPetListeners(){
  document.querySelectorAll('.pet').forEach(cb=>{
    cb.addEventListener('change',()=>{
      const row=cb.closest('tr');
      if(cb.checked){
        row.dataset.petEnd=(nowUTC().getTime()+PET_DURATION_MS).toString();
        row.dataset.petState="active";
        updatePetStatus(row);
      }else{
        delete row.dataset.petEnd; delete row.dataset.petState;
        row.querySelector('.pet-status').textContent="âšª â€•";
        row.classList.remove("pet-active-row","pet-expired-row");
      }
    });
  });
}
function updatePetStatus(row){
  const cell=row.querySelector('.pet-status');
  if(!row.dataset.petEnd)return;
  const diff=Number(row.dataset.petEnd)-nowUTC();
  if(diff<=0){
    row.dataset.petState="expired";
    cell.textContent="âš«ï¸ â€•";
    row.classList.remove("pet-active-row");
    row.classList.add("pet-expired-row");
    return;
  }
  const h=Math.floor(diff/3600000),m=Math.floor(diff%3600000/60000),s=Math.floor(diff%60000/1000);
  cell.innerHTML=`ğŸ¶ ç™ºå‹•ä¸­ <span class="time">${h}:${pad(m)}:${pad(s)}</span>`;
  row.classList.add("pet-active-row");
  row.classList.remove("pet-expired-row");
}
setInterval(()=>document.querySelectorAll('#tbody tr').forEach(updatePetStatus),1000);
setPetListeners();

// ãƒšãƒƒãƒˆåˆ—è¡¨ç¤ºåˆ‡æ›¿
document.getElementById('togglePet').addEventListener('change', e=>{
  const table=document.getElementById('tbl');
  if(e.target.checked)table.classList.remove('hide-pet');
  else table.classList.add('hide-pet');
});

// ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿
document.getElementById('mode').addEventListener('change',()=>{
  document.getElementById('impactBox').style.display=
    document.getElementById('mode').value==="reverse"?"block":"none";
});

// è¡Œè¿½åŠ ãƒ»å‰Šé™¤
document.getElementById('addBtn').addEventListener('click',()=>{
  const tr=document.createElement('tr');
  tr.innerHTML=`<td><input type="checkbox" class="pet"></td>
  <td><input type="text" placeholder="åå‰"></td>
  <td>${document.getElementById('marchSelect').outerHTML}</td>
  <td>-</td><td class="pet-status pet-inactive">âšª â€•</td>`;
  document.getElementById('tbody').appendChild(tr);
  setPetListeners();
});
document.getElementById('removeBtn').addEventListener('click',()=>{
  const rows=document.querySelectorAll('#tbody tr');
  if(rows.length===0){alert("å‰Šé™¤ã§ãã‚‹è¡ŒãŒã‚ã‚Šã¾ã›ã‚“ã€‚");return;}
  rows[rows.length-1].remove();
});

// è¨ˆç®—
document.getElementById('calcBtn').addEventListener('click',()=>{
  const rallyMin=+document.getElementById('rally').value;
  const mode=document.getElementById('mode').value;
  const prep=+document.getElementById('prep').value;
  const rows=[...document.querySelectorAll('#tbody tr')];
  const now=nowUTC();
  const members=rows.map(r=>{
    const name=r.children[1].querySelector('input').value.trim()||'Player';
    const march=+r.querySelector('.march').value;
    const petState=r.dataset.petState||"none";
    return {r,name,march,petState};
  });
  let target;
  if(mode==="normal"){
    const base=new Date(now.getTime()+prep*1000);
    const max=Math.max(...members.map(m=>m.march),0);
    target=new Date(base.getTime()+max*1000+rallyMin*60*1000);
    members.forEach(m=>{
      const depart=new Date(base.getTime()+(max-m.march)*1000);
      m.r.children[3].textContent=`${fmtUTC(depart)} UTC`;
      m.depart=depart;
    });
  }else{
    const [hh,mm,ss="0"]=document.getElementById('impactTime').value.split(':');
    const targetUTC=new Date(nowUTC());
    targetUTC.setUTCHours(+hh,+mm,+ss,0);
    target=targetUTC;
    members.forEach(m=>{
      const depart=new Date(target.getTime()-(rallyMin*60*1000)-(m.march*1000));
      m.r.children[3].textContent=`${fmtUTC(depart)} UTC`;
      m.depart=depart;
    });
  }
  document.getElementById('commonImpact').textContent=`${fmtUTC(target)} UTC`;
  const lines=[`${rallyMin}åˆ†é›†çµãŠé¡˜ã„ã—ã¾ã™ï¼ğŸ™‡â€â™‚ï¸ğŸ™‡â€â™‚ï¸âœ¨`,""];
  members.forEach(m=>{
    let icon="âšªï¸";if(m.petState==="active")icon="ğŸ¶";else if(m.petState==="expired")icon="âš«ï¸";
    lines.push(`${icon}${m.name}ã€€${fmtUTC(m.depart)} UTC`);
  });
  lines.push("",`ç€å¼¾ï¼š${fmtUTC(target)} UTC`);
  document.getElementById('copyBox').textContent=lines.join('\n');
});

// ã‚³ãƒ”ãƒ¼
document.getElementById('copyBtn').addEventListener('click',async()=>{
  const txt=document.getElementById('copyBox').textContent;
  try{await navigator.clipboard.writeText(txt);alert('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚');}
  catch{
    const ta=document.createElement('textarea');ta.value=txt;document.body.appendChild(ta);
    ta.select();document.execCommand('copy');ta.remove();alert('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚');
  }
});
</script>
</body>
</html>