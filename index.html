<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Arrival Marineï¼ˆUTCï¼‰</title>
<style>
:root{
  --brand:#1565C0; --brand-2:#1976d2;
  --bg:#f7f9ff; --text:#1f2937; --line:#d7deeb;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);
     font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans JP",sans-serif}
header.appbar{
  background:var(--brand); color:#fff; padding:10px 14px;
  display:flex; align-items:center; justify-content:space-between;
}
.appbar .title{font-weight:800;letter-spacing:.5px}
.appbar .badge{
  background:rgba(255,255,255,.2); padding:4px 10px; border-radius:10px;
  font-family:"Roboto Mono",monospace; font-weight:700;
}
main{max-width:720px;margin:0 auto;padding:12px}
.card{
  background:#fff;border:1px solid var(--line);border-radius:14px;
  box-shadow:0 1px 4px rgba(0,0,0,.05); padding:14px; margin:12px 0;
}

/* å…±é€šUI */
label{font-size:13px;color:#374151;font-weight:600}
select,input[type="text"]{
  width:100%; padding:8px 10px; font-size:15px; background:#fbfdff;
  border:1px solid var(--line); border-radius:12px;
}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.row.center{justify-content:center}
.btn{
  border:none;border-radius:12px;font-weight:800;cursor:pointer;transition:.15s
}
.btn:active{transform:scale(.98)}
.btn-primary{background:var(--brand);color:#fff;padding:12px 16px}
.btn-primary:hover{background:var(--brand-2)}
.btn-ghost{background:#eef3ff;color:var(--brand);padding:8px 12px}
.btn-danger{background:#fee2e2;color:#b91c1c;padding:8px 12px}

.helper{font-size:12px;color:#6b7280}

/* è¢«ã›ã®ä¸€è¡Œï¼šâ¬œ ç§’å¾Œã« â¬œ åˆ†é›†çµ */
.pill-row{display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:center}
.pill-row select{width:90px;text-align:center}

/* ç€å¼¾ã® 12 : 00 : 00 */
.time-row{display:flex;align-items:center;gap:8px;justify-content:center}
.time-row select{width:90px;text-align:center}

/* ãƒ†ãƒ¼ãƒ–ãƒ« */
.table-wrap{overflow-x:auto}
table{width:100%;border-collapse:collapse;text-align:center;font-size:14px}
th,td{border:1px solid var(--line);padding:8px}
th{background:#eef3ff;color:#0f4aa8;font-weight:700}
tbody tr:nth-child(odd){background:#fafcff}
tr.pet-on{background:#eaf3ff!important}

/* ãƒšãƒƒãƒˆåˆ—ã®è¡¨ç¤º/éè¡¨ç¤º */
.hide-pet th:first-child,.hide-pet td:first-child,
.hide-pet th:last-child,.hide-pet td:last-child{display:none}

/* ã‚³ãƒ”ãƒ¼æ¬„ */
.copy{white-space:pre-wrap;font-family:ui-monospace,Menlo,monospace;
      background:#fbfdff;border:1px solid var(--line);border-radius:12px;
      padding:10px;min-height:68px}
.footer{color:#9aa3b2;text-align:center;font-size:12px;padding:18px 0 28px}
</style>
</head>
<body>
<header class="appbar">
  <div class="title">Arrival Marine</div>
  <div class="badge">UTC: <span id="utcClock">--:--:--</span></div>
</header>

<main>
  <!-- ãƒ¢ãƒ¼ãƒ‰ï¼†å…¥åŠ› -->
  <section class="card">
    <div class="row" style="justify-content:space-between">
      <label>ãƒ¢ãƒ¼ãƒ‰é¸æŠï¼š</label>
      <select id="mode" style="max-width:220px">
        <option value="normal" selected>è¢«ã›é›†çµ</option>
        <option value="reverse">ç€å¼¾æ™‚åˆ»æŒ‡å®š</option>
      </select>
    </div>

    <!-- è¢«ã› -->
    <div id="box-normal" style="margin-top:10px">
      <div class="pill-row">
        <select id="prep"><option>30</option><option>60</option><option>90</option><option>120</option></select>
        <span>ç§’å¾Œã«</span>
        <select id="rally"><option>5</option><option>10</option><option>15</option></select>
        <span>åˆ†é›†çµ</span>
      </div>
      <div class="row center" style="margin-top:8px">
        <button id="fireNormal" class="btn btn-primary">é›†çµãŒããŸï¼</button>
        <button id="addRow" class="btn btn-ghost">ï¼‹ è¿½åŠ </button>
        <button id="removeRow" class="btn btn-danger">âˆ’ å‰Šé™¤</button>
      </div>
      <p id="normalPreview" class="helper" style="text-align:center;margin-top:6px">
        å…±é€šç€å¼¾äºˆå®šï¼š--:--:-- UTC
      </p>
    </div>

    <!-- ç€å¼¾æŒ‡å®š -->
    <div id="box-reverse" style="display:none;margin-top:10px">
      <div class="time-row">
        <select id="hh"></select> <span>:</span>
        <select id="mm"></select> <span>:</span>
        <select id="ss"></select>
      </div>
      <p id="revPreview" class="helper" style="text-align:center;margin-top:6px">
        ç€å¼¾äºˆå®šæ™‚åˆ»ï¼š--:--:-- UTC
      </p>
      <div class="row center">
        <span>åˆ†é›†çµ</span>
        <select id="rallyReverse" style="width:90px"><option>5</option><option>10</option><option>15</option></select>
      </div>
      <div class="row center" style="margin-top:8px">
        <button id="fireReverse" class="btn btn-primary">è¨ˆç®—ã™ã‚‹</button>
      </div>
    </div>

    <div class="row" style="justify-content:flex-end;margin-top:6px">
      <label class="helper"><input type="checkbox" id="togglePet" checked> ãƒšãƒƒãƒˆè¡¨ç¤º</label>
    </div>
  </section>

  <!-- ãƒ†ãƒ¼ãƒ–ãƒ« -->
  <section class="card table-wrap">
    <table id="tbl">
      <thead>
        <tr><th>ğŸ¶</th><th>é›†çµä¸»</th><th>è¡Œè»ï¼ˆç§’ï¼‰</th><th>å‡ºç™ºï¼ˆUTCï¼‰</th><th>æ®‹ã‚ŠğŸ¾</th></tr>
      </thead>
      <tbody id="tbody">
        <tr>
          <td><input type="checkbox" class="pet"></td>
          <td><input type="text" placeholder="ä¾‹ï¼šMarine"></td>
          <td><select class="march"></select></td>
          <td>-</td><td class="pet-left">-</td>
        </tr>
        <tr>
          <td><input type="checkbox" class="pet"></td>
          <td><input type="text" placeholder="ä¾‹ï¼šYumi"></td>
          <td><select class="march"></select></td>
          <td>-</td><td class="pet-left">-</td>
        </tr>
      </tbody>
    </table>
  </section>

  <!-- ã‚³ãƒ”ãƒ¼ -->
  <section class="card">
    <label>ã‚³ãƒ”ãƒ¼ç”¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</label>
    <div id="copyBox" class="copy">ï¼ˆè¨ˆç®—ã™ã‚‹ã¨ã“ã“ã«æ•´å½¢ãƒ†ã‚­ã‚¹ãƒˆãŒå‡ºã¾ã™ï¼‰</div>
    <div class="row center" style="margin-top:8px">
      <button id="copyBtn" class="btn btn-ghost">ã‚³ãƒ”ãƒ¼</button>
    </div>
  </section>
</main>

<div class="footer">Â© Arrival Marine</div>

<script>
// ===== å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ =====
const pad = n => String(n).padStart(2,'0');
const fmtUTC = d => `${pad(d.getUTCHours())}:${pad(d.getUTCMinutes())}:${pad(d.getUTCSeconds())}`;
const nowUTC = () => new Date();
setInterval(()=>{document.getElementById('utcClock').textContent=fmtUTC(nowUTC());},1000);

// ===== è¡Œè»ã‚»ãƒ¬ã‚¯ãƒˆ: 34ã€œ180ç§’ =====
function fillMarch(sel){
  for(let s=34;s<=180;s++){
    const m=Math.floor(s/60), sec=s%60;
    sel.add(new Option((m?`${m}åˆ†`:'')+`${sec}ç§’`, s));
  }
}
document.querySelectorAll('.march').forEach(fillMarch);

// ===== ç€å¼¾æŒ‡å®šãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ =====
(function(){
  const hh=document.getElementById('hh'), mm=document.getElementById('mm'), ss=document.getElementById('ss');
  for(let h=0;h<24;h++) hh.add(new Option(pad(h), h));
  for(let m=0;m<60;m+=5) mm.add(new Option(pad(m), m)); // 5åˆ†åˆ»ã¿
  for(let s=0;s<60;s+=10) ss.add(new Option(pad(s), s)); // 10ç§’åˆ»ã¿
  const now=nowUTC(); hh.value=now.getUTCHours(); mm.value=Math.floor(now.getUTCMinutes()/5)*5; ss.value=0;
})();

// ===== ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ =====
const modeSel=document.getElementById('mode');
function applyMode(){
  const rev=modeSel.value==='reverse';
  document.getElementById('box-normal').style.display = rev ? 'none':'block';
  document.getElementById('box-reverse').style.display = rev ? 'block':'none';
}
modeSel.addEventListener('change',applyMode); applyMode();

// ===== ãƒšãƒƒãƒˆè¡¨ç¤º ON/OFF =====
const tbl=document.getElementById('tbl');
document.getElementById('togglePet').addEventListener('change',e=>{
  tbl.classList.toggle('hide-pet', !e.target.checked);
});

// ===== ãƒšãƒƒãƒˆ2æ™‚é–“ã‚«ã‚¦ãƒ³ãƒˆ =====
const PET_MS = 2*60*60*1000;
function bindPetHandlers(scope=document){
  scope.querySelectorAll('.pet').forEach(cb=>{
    cb.onchange = ()=>{
      const row = cb.closest('tr');
      const cell = row.querySelector('.pet-left');
      if(cb.checked){
        row.dataset.petEnd = (Date.now()+PET_MS).toString();
        row.classList.add('pet-on');
      }else{
        row.classList.remove('pet-on');
        cell.textContent='-';
        delete row.dataset.petEnd;
      }
    };
  });
}
bindPetHandlers();
setInterval(()=>{
  document.querySelectorAll('#tbody tr').forEach(row=>{
    if(!row.dataset.petEnd) return;
    const diff = row.dataset.petEnd - Date.now();
    const cell = row.querySelector('.pet-left');
    if(diff<=0){ cell.textContent='âš« çµ‚äº†'; row.classList.remove('pet-on'); delete row.dataset.petEnd; return; }
    const h=Math.floor(diff/3600000), m=Math.floor((diff%3600000)/60000), s=Math.floor((diff%60000)/1000);
    cell.textContent = `ğŸ¶ ${h}:${pad(m)}:${pad(s)}`;
  });
},1000);

// ===== è¡Œã®è¿½åŠ /å‰Šé™¤ =====
document.getElementById('addRow').onclick=()=>{
  const tr=document.createElement('tr');
  tr.innerHTML = `
    <td><input type="checkbox" class="pet"></td>
    <td><input type="text" placeholder="åå‰"></td>
    <td><select class="march"></select></td>
    <td>-</td><td class="pet-left">-</td>`;
  document.getElementById('tbody').appendChild(tr);
  fillMarch(tr.querySelector('.march'));
  bindPetHandlers(tr);
};
document.getElementById('removeRow').onclick=()=>{
  const rows = document.querySelectorAll('#tbody tr');
  if(rows.length>1) rows[rows.length-1].remove();
};

// ===== ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆè¢«ã›ï¼ç€å¼¾ï¼‰=====
function updateNormalPreview(){
  const prep=+document.getElementById('prep').value;
  const rally=+document.getElementById('rally').value;
  const impact = new Date(nowUTC().getTime()+prep*1000+rally*60*1000);
  document.getElementById('normalPreview').textContent = `å…±é€šç€å¼¾äºˆå®šï¼š${fmtUTC(impact)} UTC`;
}
['prep','rally'].forEach(id=>document.getElementById(id).addEventListener('change',updateNormalPreview));
function updateRevPreview(){
  const hh=+document.getElementById('hh').value, mm=+document.getElementById('mm').value, ss=+document.getElementById('ss').value;
  document.getElementById('revPreview').textContent = `ç€å¼¾äºˆå®šæ™‚åˆ»ï¼š${pad(hh)}:${pad(mm)}:${pad(ss)} UTC`;
}
['hh','mm','ss'].forEach(id=>document.getElementById(id).addEventListener('change',updateRevPreview));
updateNormalPreview(); updateRevPreview();

// ===== è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ =====
function computeNormal(){
  const rally=+document.getElementById('rally').value;
  const prep =+document.getElementById('prep').value;
  const rows=[...document.querySelectorAll('#tbody tr')].map(r=>({
    r, name:(r.querySelector('input[type=text]').value||'Player'),
    march:+r.querySelector('.march').value
  }));
  const base=new Date(nowUTC().getTime()+prep*1000);
  const max = Math.max(...rows.map(x=>x.march),0);
  const impact = new Date(base.getTime()+max*1000+rally*60*1000);
  rows.forEach(x=>{
    const depart=new Date(base.getTime()+(max-x.march)*1000);
    x.r.children[3].textContent = `${fmtUTC(depart)} UTC`;
    x.depart = depart;
  });
  document.getElementById('normalPreview').textContent = `å…±é€šç€å¼¾äºˆå®šï¼š${fmtUTC(impact)} UTC`;
  renderCopy(rally, rows, impact);
}
function computeReverse(){
  const rally=+document.getElementById('rallyReverse').value;
  const H=+document.getElementById('hh').value, M=+document.getElementById('mm').value, S=+document.getElementById('ss').value;
  const target=new Date(nowUTC()); target.setUTCHours(H,M,S,0);
  const rows=[...document.querySelectorAll('#tbody tr')].map(r=>({
    r, name:(r.querySelector('input[type=text]').value||'Player'),
    march:+r.querySelector('.march').value
  }));
  rows.forEach(x=>{
    const depart=new Date(target.getTime()-rally*60*1000-x.march*1000);
    x.r.children[3].textContent = `${fmtUTC(depart)} UTC`;
    x.depart = depart;
  });
  renderCopy(rally, rows, target);
}
document.getElementById('fireNormal').onclick=computeNormal;
document.getElementById('fireReverse').onclick=computeReverse;

// ===== ã‚³ãƒ”ãƒ¼ =====
function renderCopy(rally,rows,impact){
  const lines = [`(${rally}åˆ†é›†çµãŠé¡˜ã„ã—ã¾ã™ï¼)`,''];
  rows.forEach(x=>{
    const icon = x.r.querySelector('.pet')?.checked ? 'ğŸ¶':'âšª';
    lines.push(`${icon}${x.name}ã€€${fmtUTC(x.depart)} UTC`);
  });
  lines.push('',`ç€å¼¾ï¼š${fmtUTC(impact)} UTC`);
  document.getElementById('copyBox').textContent = lines.join('\n');
}
document.getElementById('copyBtn').onclick=async()=>{
  const text=document.getElementById('copyBox').textContent;
  try{await navigator.clipboard.writeText(text); alert('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');}
  catch{
    const ta=document.createElement('textarea'); ta.value=text;
    document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove();
    alert('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
  }
};
</script>
</body>
</html>