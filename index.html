<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Arrival Marine (ğŸ¶ã‚¹ãƒãƒ›å¯¾å¿œç‰ˆ)</title>
<style>
  :root{
    --navy:#1565C0;
    --bg:#f5f8ff;
    --text:#1f2937;
    --muted:#6b7280;
    --line:#d1d5db;
  }
  *{box-sizing:border-box;}
  body{
    margin:0; background:var(--bg); color:var(--text);
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans JP","Yu Gothic",sans-serif;
  }
  header{text-align:center;padding:14px 10px;}
  header .clock{
    display:inline-block;background:#eef3fb;color:var(--navy);
    padding:12px 20px;border-radius:10px;
    font-size:clamp(1.4rem,4vw,2.2rem);font-weight:bold;
    font-variant-numeric:tabular-nums;
  }
  main{max-width:860px;margin:0 auto;padding:10px;}
  .card{
    background:#fff;border:1px solid var(--line);border-radius:14px;
    padding:12px;margin:10px 0;box-shadow:0 1px 3px rgba(0,0,0,0.05);
  }
  label{display:block;font-size:13px;color:var(--muted);margin-bottom:4px;}
  select,input,button{font-size:16px;border-radius:10px;}
  select,input[type="number"],input[type="text"]{
    width:100%;padding:10px;border:1px solid var(--line);background:#fff;
  }
  button{
    background:var(--navy);color:#fff;border:none;
    padding:12px 16px;border-radius:10px;font-weight:600;
  }
  button.secondary{
    background:#f3f4f6;color:#111827;border:1px solid var(--line);
  }
  .actions{display:flex;gap:8px;flex-wrap:wrap;}
  table{width:100%;border-collapse:collapse;}
  th,td{
    border:1px solid var(--line);
    padding:10px 4px;text-align:center;font-size:14px;
  }
  th{background:#f0f4ff;color:#1e3a8a;font-weight:600;}
  .pet-status{font-weight:500;}
  .pet-active{color:var(--navy);}
  .pet-inactive{color:#9ca3af;}
  #copyBox{
    white-space:pre-wrap;
    font-family:monospace;
    background:#fff;
    border:1px solid var(--line);
    border-radius:10px;
    padding:10px;
    min-height:70px;
  }
  @media (max-width:600px){
    th,td{font-size:13px;padding:6px;}
    button{width:100%;font-size:15px;}
  }
</style>
</head>
<body>

<header>
  <div class="clock" id="utcClock">UTC: --:--:--</div>
</header>

<main>
  <section class="card">
    <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
      <div style="flex:1 1 120px;">
        <label>æº–å‚™æ™‚é–“ï¼ˆç§’ï¼‰</label>
        <select id="prep">
          <option value="30">30</option>
          <option value="60">60</option>
          <option value="90">90</option>
          <option value="120">120</option>
        </select>
      </div>
      <div style="flex:1 1 120px;">
        <label>é›†çµæ™‚é–“ï¼ˆåˆ†ï¼‰</label>
        <select id="rally">
          <option value="5">5</option>
          <option value="10">10</option>
          <option value="15">15</option>
        </select>
      </div>
      <div class="actions" style="flex:1 1 100%;">
        <button class="secondary" id="addBtn">ï¼‹è¿½åŠ </button>
        <button id="calcBtn">é›†çµãŒããŸï¼</button>
        <span style="font-size:12px;color:#6b7280;">â€»è¢«ã›é›†çµ</span>
      </div>
    </div>
  </section>

  <section class="card">
    <table id="tbl">
      <thead>
        <tr>
          <th style="width:5%">ğŸ¶</th>
          <th style="width:30%">é›†çµä¸»</th>
          <th style="width:20%">è¡Œè»ï¼ˆä½•åˆ†ä½•ç§’ï¼‰</th>
          <th style="width:25%">å‡ºç™ºï¼ˆUTCï¼‰</th>
          <th style="width:20%">ãƒšãƒƒãƒˆ</th>
        </tr>
      </thead>
      <tbody id="tbody">
        <tr>
          <td><input type="checkbox" class="pet"></td>
          <td><input type="text" placeholder="ä¾‹ï¼šMarine"></td>
          <td>
            <select class="march" id="marchSelect">
              <!-- è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ -->
            </select>
          </td>
          <td>-</td>
          <td class="pet-status pet-inactive">âšª â€•</td>
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="3" style="text-align:right;font-weight:600;">å…±é€šç€å¼¾ï¼ˆUTCï¼‰</td>
          <td colspan="2" id="commonImpact">-</td>
        </tr>
      </tfoot>
    </table>
  </section>

  <section class="card">
    <label>ã‚³ãƒ”ãƒ¼ç”¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</label>
    <div id="copyBox">ï¼ˆè¨ˆç®—ã™ã‚‹ã¨ã“ã“ã«æ•´å½¢ãƒ†ã‚­ã‚¹ãƒˆãŒå‡ºã¾ã™ï¼‰</div>
    <div style="margin-top:8px;">
      <button class="secondary" id="copyBtn">ã‚³ãƒ”ãƒ¼</button>
    </div>
  </section>

  <footer style="text-align:center;color:#6b7280;font-size:12px;padding:10px 0 20px;">
    Â© Arrival Marine
  </footer>
</main>

<script>
// === UTCæ™‚è¨ˆ ===
function pad(n){return String(n).padStart(2,'0');}
function fmtUTC(d){return `${pad(d.getUTCHours())}:${pad(d.getUTCMinutes())}:${pad(d.getUTCSeconds())}`;}
function nowUTC(){return new Date();}
function tickClock(){document.getElementById('utcClock').textContent=`UTC ${fmtUTC(nowUTC())}`;}
setInterval(tickClock,1000);tickClock();

// === ãƒšãƒƒãƒˆçŠ¶æ…‹ ===
const PET_DURATION_MS=2*60*60*1000;
function setPetListeners(){
  document.querySelectorAll('.pet').forEach(cb=>{
    cb.addEventListener('change',()=>{
      const row=cb.closest('tr');
      const cell=row.querySelector('.pet-status');
      if(cb.checked){
        const start=nowUTC(),end=new Date(start.getTime()+PET_DURATION_MS);
        row.dataset.petEnd=end.getTime();
        row.dataset.petState="active";
        updatePetStatus(row);
      }else clearPet(row);
    });
  });
}
function clearPet(row){
  const cell=row.querySelector('.pet-status');
  delete row.dataset.petEnd;delete row.dataset.petState;
  cell.textContent="âšª â€•";
  cell.classList.remove('pet-active');cell.classList.add('pet-inactive');
}
function updatePetStatus(row){
  const cell=row.querySelector('.pet-status');
  if(!row.dataset.petEnd)return;
  const diff=Number(row.dataset.petEnd)-nowUTC();
  if(diff<=0){row.dataset.petState="expired";cell.textContent="âš«ï¸ â€•";return;}
  row.dataset.petState="active";
  const h=Math.floor(diff/3600000);
  const m=Math.floor((diff%3600000)/60000);
  const s=Math.floor((diff%60000)/1000);
  cell.textContent=`ğŸ”µ ${h}:${pad(m)}:${pad(s)}`;
}
setInterval(()=>document.querySelectorAll('#tbody tr').forEach(updatePetStatus),1000);
setPetListeners();

// === è¡Œè»æ™‚é–“ã€Œä½•åˆ†ä½•ç§’ã€ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ç”Ÿæˆ ===
function createMarchSelect() {
  const select = document.createElement('select');
  select.className = 'march';
  for (let sec = 13; sec <= 180; sec++) {
    const min = Math.floor(sec / 60);
    const s = sec % 60;
    const label = `${min}åˆ†${s.toString().padStart(2,'0')}ç§’`;
    const opt = document.createElement('option');
    opt.value = sec;
    opt.textContent = label;
    select.appendChild(opt);
  }
  return select.outerHTML;
}
document.addEventListener("DOMContentLoaded", () => {
  const marchSelect = document.getElementById('marchSelect');
  if (marchSelect) {
    for (let sec = 13; sec <= 180; sec++) {
      const min = Math.floor(sec / 60);
      const s = sec % 60;
      const label = `${min}åˆ†${s.toString().padStart(2,'0')}ç§’`;
      const opt = document.createElement('option');
      opt.value = sec;
      opt.textContent = label;
      marchSelect.appendChild(opt);
    }
  }
});

// === è¡Œè¿½åŠ  ===
document.getElementById('addBtn').addEventListener('click',()=>{
  const tr=document.createElement('tr');
  tr.innerHTML=`
    <td><input type="checkbox" class="pet"></td>
    <td><input type="text" placeholder="åå‰"></td>
    <td>${createMarchSelect()}</td>
    <td>-</td>
    <td class="pet-status pet-inactive">âšª â€•</td>`;
  document.getElementById('tbody').appendChild(tr);
  setPetListeners();
});

// === è¨ˆç®—ãƒœã‚¿ãƒ³ ===
document.getElementById('calcBtn').addEventListener('click',()=>{
  const prep=+document.getElementById('prep').value;
  const rallyMin=+document.getElementById('rally').value;
  const rows=[...document.querySelectorAll('#tbody tr')];
  const now=nowUTC();
  const members=rows.map(r=>{
    const name=r.children[1].querySelector('input').value.trim()||'Player';
    const march=+r.querySelector('.march').value;
    const petState=r.dataset.petState||"none";
    return {r,name,march,petState};
  });
  if(!members.length)return;
  const base=new Date(now.getTime()+prep*1000);
  const max=Math.max(...members.map(m=>m.march));
  const target=new Date(base.getTime()+max*1000+rallyMin*60*1000);
  members.forEach(m=>{
    const depart=new Date(base.getTime()+(max-m.march)*1000);
    m.r.children[3].textContent=`${fmtUTC(depart)} UTC`;
    m.depart=depart;
  });
  document.getElementById('commonImpact').textContent=`${fmtUTC(target)} UTC`;

  const lines=[`${rallyMin}åˆ†é›†çµãŠé¡˜ã„ã—ã¾ã™ï¼ğŸ™‡â€â™‚ï¸ğŸ™‡â€â™‚ï¸âœ¨`,""];
  members.forEach(m=>{
    let icon="âšªï¸";if(m.petState==="active")icon="ğŸ¶";else if(m.petState==="expired")icon="âš«ï¸";
    lines.push(`${icon}${m.name}ã€€${fmtUTC(m.depart)} UTC`);
  });
  lines.push("",`ç€å¼¾ï¼š${fmtUTC(target)} UTC`);
  document.getElementById('copyBox').textContent=lines.join('\n');
});

// === ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ ===
document.getElementById('copyBtn').addEventListener('click',async()=>{
  const txt=document.getElementById('copyBox').textContent;
  try{await navigator.clipboard.writeText(txt);alert('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚');}
  catch(e){const ta=document.createElement('textarea');
    ta.value=txt;document.body.appendChild(ta);ta.select();document.execCommand('copy');ta.remove();
    alert('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚');}
});
</script>
</body>
</html>