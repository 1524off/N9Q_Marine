<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>é›†çµæ™‚é–“è¨ˆç®—æ©Ÿ</title>
<style>
:root {
  --navy: #1565C0;
  --bg: #f7f9ff;
  --text: #1f2937;
  --line: #d1d5db;
  --muted: #6b7280;
}
body {
  margin: 0;
  font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans JP",sans-serif;
  background: var(--bg);
  color: var(--text);
}
header {
  text-align: center;
  padding: 10px 0 5px;
  font-weight: 600;
}
.clock { font-size: 1.4rem; font-weight: 700; color: var(--navy);}
main {
  max-width: 640px;
  margin: 0 auto;
  padding: 8px;
}
section {
  background: #fff;
  border: 1px solid var(--line);
  border-radius: 10px;
  padding: 10px 12px;
  margin-bottom: 10px;
}

/* åŸºæœ¬ */
label { font-size: 14px; font-weight: 500; color: #374151; }
select, input[type=text] {
  font-size: 14px;
  padding: 6px;
  border: 1px solid var(--line);
  border-radius: 8px;
  width: 100%;
}

/* ãƒœã‚¿ãƒ³ */
button {
  border: none; border-radius: 8px;
  font-size: 15px; font-weight: 600;
  padding: 10px; width: 100%;
  transition: 0.2s;
}
#calcBtn {
  background: var(--navy); color: #fff; margin-top: 6px;
}
#calcBtn:hover { background: #0b4aa8; }
.smallBtn {
  width: auto; padding: 6px 12px; margin: 4px;
  font-size: 18px; border-radius: 8px;
}
#addBtn { background: #e5e7eb; }
#removeBtn { background: #fee2e2; color: #b91c1c; }

/* ãƒ†ãƒ¼ãƒ–ãƒ« */
table { width: 100%; border-collapse: collapse; text-align: center; font-size: 14px; }
th, td { border: 1px solid var(--line); padding: 6px; }
th { background: #f0f4ff; color: var(--navy); font-weight: 600; }
.pet-on { background: #eaf3ff; }

/* ãƒšãƒƒãƒˆåˆ—éè¡¨ç¤º */
.hide-pet th:first-child, .hide-pet td:first-child,
.hide-pet th:last-child, .hide-pet td:last-child { display: none; }

#impactDisplay {
  text-align: center; font-size: 18px;
  font-weight: 600; color: var(--navy);
  margin: 10px 0;
}

/* ã‚³ãƒ”ãƒ¼æ¬„ */
#copyBox {
  background: #fff; border: 1px solid var(--line);
  border-radius: 10px; padding: 10px;
  white-space: pre-wrap; font-family: monospace;
  min-height: 70px; font-size: 13px;
}

/* ãƒ•ãƒƒã‚¿ãƒ¼ */
footer {
  text-align: center;
  font-size: 12px;
  color: var(--muted);
  padding: 10px 0 20px;
}
</style>
</head>
<body>

<header>
  ç¾åœ¨æ™‚åˆ»ã€€<span class="clock" id="utcClock">--:--:--</span> UTC
</header>

<main>
  <!-- ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ -->
  <section>
    <label>ãƒ¢ãƒ¼ãƒ‰é¸æŠï¼š</label>
    <select id="mode">
      <option value="normal">è¢«ã›é›†çµ</option>
      <option value="reverse">ç€å¼¾æŒ‡å®š</option>
    </select>

    <div id="reverseBox" style="display:none;margin-top:8px;">
      <label>å…±æœ‰ç€å¼¾æ™‚åˆ»ï¼ˆUTC12:00ã€œ15:00ï¼‰</label>
      <select id="impactTime"></select>
    </div>

    <div id="normalBox" style="margin-top:8px;">
      <label>æº–å‚™æ™‚é–“ï¼ˆç§’ï¼‰</label>
      <select id="prep"><option>30</option><option>60</option><option>90</option><option>120</option></select>
      <label>é›†çµæ™‚é–“ï¼ˆåˆ†ï¼‰</label>
      <select id="rally"><option>5</option><option>10</option><option>15</option></select>
    </div>

    <button id="calcBtn">æ•µé›†çµãŒããŸï¼</button>

    <div style="display:flex;align-items:center;justify-content:space-between;margin-top:6px;">
      <div>
        <button id="addBtn" class="smallBtn">ï¼‹</button>
        <button id="removeBtn" class="smallBtn">âˆ’</button>
      </div>
      <label><input type="checkbox" id="showPet" checked> ãƒšãƒƒãƒˆè¡¨ç¤º</label>
    </div>
  </section>

  <!-- è¡¨ -->
  <section>
    <table id="tbl">
      <thead>
        <tr><th>âœ…</th><th>é›†çµä¸»</th><th>è¡Œè»</th><th>å‡ºç™º(UTC)</th><th>ğŸ¶ æ®‹ã‚Šæ™‚é–“</th></tr>
      </thead>
      <tbody id="tbody">
        <tr>
          <td><input type="checkbox" class="pet"></td>
          <td><input type="text" value="Marine"></td>
          <td><select class="march"></select></td>
          <td>-</td><td class="pet-time">-</td>
        </tr>
      </tbody>
    </table>
  </section>

  <div id="impactDisplay">å…±é€šç€å¼¾æ™‚åˆ»ã€€--:--:-- UTC</div>

  <section>
    <label>ã‚³ãƒ”ãƒ¼ç”¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</label>
    <div id="copyBox">ï¼ˆè¨ˆç®—çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰</div>
    <button id="copyBtn">ã‚³ãƒ”ãƒ¼</button>
  </section>

</main>

<footer>Â© 1524 Off_Marine</footer>

<script>
function pad(n){return String(n).padStart(2,"0");}
function fmtUTC(d){return `${pad(d.getUTCHours())}:${pad(d.getUTCMinutes())}:${pad(d.getUTCSeconds())}`;}
function nowUTC(){return new Date();}
setInterval(()=>{document.getElementById("utcClock").textContent=fmtUTC(nowUTC());},1000);

/* è¡Œè»ãƒªã‚¹ãƒˆ */
function fillMarch(sel){
  for(let s=13;s<=180;s++){
    const m=Math.floor(s/60),sec=s%60;
    const opt=document.createElement("option");
    opt.value=s;opt.textContent=`${m>0?m+"åˆ†":""}${sec}ç§’`;
    sel.appendChild(opt);
  }
}
document.querySelectorAll(".march").forEach(fillMarch);

/* ç€å¼¾æŒ‡å®šãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ï¼ˆ12:00ã€œ15:00ï¼‰ */
const impactSelect=document.getElementById("impactTime");
for(let h=12;h<=15;h++){
  for(let m=0;m<60;m++){
    const opt=document.createElement("option");
    opt.value=`${pad(h)}:${pad(m)}`;
    opt.textContent=`${pad(h)}:${pad(m)}`;
    impactSelect.appendChild(opt);
  }
}

/* ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ */
document.getElementById("mode").addEventListener("change",()=>{
  const mode=document.getElementById("mode").value;
  const btn=document.getElementById("calcBtn");
  if(mode==="reverse"){
    document.getElementById("reverseBox").style.display="block";
    document.getElementById("normalBox").style.display="none";
    btn.textContent="è¨ˆç®—ã™ã‚‹";
  }else{
    document.getElementById("reverseBox").style.display="none";
    document.getElementById("normalBox").style.display="block";
    btn.textContent="æ•µé›†çµãŒããŸï¼";
  }
});

/* ãƒšãƒƒãƒˆè¡¨ç¤ºON/OFF */
document.getElementById("showPet").addEventListener("change",e=>{
  document.getElementById("tbl").classList.toggle("hide-pet",!e.target.checked);
});

/* è¿½åŠ  */
document.getElementById("addBtn").addEventListener("click",()=>{
  const tr=document.createElement("tr");
  tr.innerHTML=`<td><input type="checkbox" class="pet"></td>
  <td><input type="text"></td>
  <td><select class="march"></select></td>
  <td>-</td><td class="pet-time">-</td>`;
  document.getElementById("tbody").appendChild(tr);
  fillMarch(tr.querySelector(".march"));
  setPetListeners();
});

/* å‰Šé™¤ */
document.getElementById("removeBtn").addEventListener("click",()=>{
  const rows=document.querySelectorAll("#tbody tr");
  if(rows.length>1) rows[rows.length-1].remove();
});

/* ãƒšãƒƒãƒˆã‚¿ã‚¤ãƒãƒ¼ */
const PET_DURATION_MS=2*60*60*1000;
function setPetListeners(){
  document.querySelectorAll(".pet").forEach(cb=>{
    cb.addEventListener("change",()=>{
      const row=cb.closest("tr");
      if(cb.checked){
        row.dataset.petEnd=Date.now()+PET_DURATION_MS;
        row.classList.add("pet-on");
      }else{
        delete row.dataset.petEnd;
        row.classList.remove("pet-on");
        row.querySelector(".pet-time").textContent="-";
      }
    });
  });
}
setPetListeners();

/* ãƒšãƒƒãƒˆæ™‚é–“æ›´æ–° */
setInterval(()=>{
  document.querySelectorAll("#tbody tr").forEach(row=>{
    if(row.dataset.petEnd){
      const diff=row.dataset.petEnd-Date.now();
      if(diff<=0){row.classList.remove("pet-on");row.querySelector(".pet-time").textContent="âš« çµ‚äº†";delete row.dataset.petEnd;}
      else{
        const h=Math.floor(diff/3600000),m=Math.floor((diff%3600000)/60000),s=Math.floor((diff%60000)/1000);
        row.querySelector(".pet-time").textContent=`ğŸ¶ ${h}:${pad(m)}:${pad(s)}`;
      }
    }
  });
},1000);

/* é›†çµè¨ˆç®—ï¼ˆç°¡æ˜“ï¼‰ */
document.getElementById("calcBtn").addEventListener("click",()=>{
  const rallyMin=+document.getElementById("rally").value;
  const prepSec=+document.getElementById("prep").value;
  const mode=document.getElementById("mode").value;
  const now=nowUTC();
  let impact;
  if(mode==="reverse"){
    const [h,m]=document.getElementById("impactTime").value.split(":").map(Number);
    impact=new Date(now);impact.setUTCHours(h,m,0,0);
  }else{
    impact=new Date(now.getTime()+prepSec*1000+rallyMin*60000);
  }
  document.getElementById("impactDisplay").textContent=`å…±é€šç€å¼¾æ™‚åˆ»ã€€${fmtUTC(impact)} UTC`;
  const lines=[`${rallyMin}åˆ†é›†çµãŠé¡˜ã„ã—ã¾ã™ï¼ğŸ™‡â€â™‚ï¸âœ¨`,""];
  document.querySelectorAll("#tbody tr").forEach(row=>{
    const name=row.querySelector("input[type=text]").value||"Player";
    const icon=row.dataset.petEnd?"ğŸ¶":"âšª";
    lines.push(`${icon}${name}`);
  });
  lines.push("",`ç€å¼¾ï¼š${fmtUTC(impact)} UTC`);
  document.getElementById("copyBox").textContent=lines.join("\n");
});

/* ã‚³ãƒ”ãƒ¼ */
document.getElementById("copyBtn").addEventListener("click",async()=>{
  const txt=document.getElementById("copyBox").textContent;
  try{
    await navigator.clipboard.writeText(txt);
    alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
  }catch{
    const ta=document.createElement("textarea");
    ta.value=txt;document.body.appendChild(ta);ta.select();document.execCommand("copy");ta.remove();
    alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
  }
});
</script>
</body>
</html>