<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Arrival Marine</title>
<style>
:root{
  --blue:#1565C0; --bg:#f5f8ff; --card:#ffffff; --border:#d1d5db; --text:#1f2937; --muted:#6b7280;
  --row-active:#e6f1ff; --field:#eef2f7;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans JP",sans-serif;color:var(--text);line-height:1.6}
.container{max-width:600px;margin:16px auto;padding:0 12px}

.card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:14px}
.header{text-align:center;margin:6px 0 10px}
.utc-big{font-size:2rem;font-weight:700;letter-spacing:.5px}

/* è¨­å®šéƒ¨ */
h1{font-size:1.05rem;margin:0;color:var(--blue)}
.small{font-size:.9rem;color:var(--muted)}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin:6px 0}
.field{background:var(--field);border:1px solid var(--border);border-radius:10px;padding:8px 10px}
label{white-space:nowrap}
select,input{font-size:1rem;padding:6px 10px;border:1px solid var(--border);border-radius:8px;background:#fff}
button.primary{background:var(--blue);color:#fff;border:none;border-radius:12px;padding:12px 18px;font-weight:700;cursor:pointer;width:100%}
button.primary:active{opacity:.9}
button.ghost{border:1px solid var(--border);background:#fff;border-radius:8px;padding:6px 10px;cursor:pointer}
.controls{display:flex;gap:8px}

/* ãƒ†ãƒ¼ãƒ–ãƒ« */
.table{width:100%;border-collapse:collapse}
.table th{font-size:.85rem;color:var(--muted);text-align:left;padding:6px 6px;background:#f0f5ff;border-bottom:1px solid #e5ecff}
.table td{padding:8px 6px;border-top:1px solid #eef2f7;background:#fff}
.name-input{width:100%;padding:6px 8px;border:1px solid var(--border);border-radius:8px}
.icon-col{width:44px;text-align:center}
.march-col{width:120px}
.dep-col{width:140px;white-space:nowrap}
.pet-col{width:64px;text-align:center}
.row-active{background:var(--row-active)}
.copy{white-space:pre-line;background:#f7faff;border:1px solid var(--border);border-radius:8px;padding:10px;min-height:3.2em}
.hidden{display:none}
.center{text-align:center}
.emph{color:var(--blue);font-weight:700}
.divider{height:1px;background:#e6eaf2;margin:10px 0;border-radius:1px}
</style>
</head>
<body>
<div class="container">

  <!-- ä¸Šéƒ¨ï¼šUTCæ™‚è¨ˆ -->
  <div class="header">
    <div id="utc-now" class="utc-big">UTC --:--:--</div>
  </div>

  <!-- è¨­å®šã‚«ãƒ¼ãƒ‰ -->
  <div class="card">
    <div class="row" style="justify-content:space-between">
      <label class="small"><input type="checkbox" id="pet-visibility" checked> ãƒšãƒƒãƒˆè¡¨ç¤º</label>
    </div>

    <div class="row field">
      <label>é¸æŠï¼š</label>
      <select id="mode-select">
        <option value="kabuse" selected>è¢«ã›é›†çµ</option>
        <option value="chakudan">ç€å¼¾æ™‚åˆ»æŒ‡å®š</option>
      </select>
    </div>

    <!-- è¢«ã›é›†çµ -->
    <div id="kabuse" class="row field">
      <select id="after-sec">
        <option>10</option><option selected>30</option><option>40</option><option>50</option><option>60</option>
      </select>
      <span>ç§’å¾Œã«</span>
      <select id="rally-min">
        <option>3</option><option selected>5</option><option>7</option><option>10</option>
      </select>
      <span>åˆ†é›†çµ</span>
    </div>

    <!-- ç€å¼¾æ™‚åˆ»æŒ‡å®š -->
    <div id="chakudan" class="row field hidden" aria-label="ç€å¼¾æ™‚åˆ»">
      <span>ç€å¼¾æ™‚åˆ»ï¼š</span>
      <select id="hh">
        <option>11</option><option selected>12</option><option>13</option><option>14</option><option>15</option>
      </select> :
      <select id="mm">
        <option>00</option><option selected>08</option><option>10</option><option>20</option><option>30</option><option>40</option><option>50</option>
      </select> :
      <select id="ss">
        <option selected>00</option><option>10</option><option>20</option><option>30</option><option>40</option><option>50</option>
      </select>
    </div>

    <div class="divider"></div>

    <button id="action-btn" class="primary">æ•µé›†çµãŒããŸï¼</button>
  </div>

  <!-- å…±é€šç€å¼¾è¡¨ç¤º -->
  <div class="card">
    <div class="center small">å…±é€šç€å¼¾æ™‚åˆ»</div>
    <div id="arrive" class="center emph" style="font-size:1.2rem;">--:--:-- UTC</div>
  </div>

  <!-- ãƒ†ãƒ¼ãƒ–ãƒ« -->
  <div class="card">
    <div class="controls" style="justify-content:flex-end;margin-bottom:6px">
      <button id="add-row" class="ghost">ï¼‹ è¿½åŠ </button>
      <button id="del-row" class="ghost">âˆ’ å‰Šé™¤</button>
    </div>
    <table class="table" id="players">
      <thead>
        <tr>
          <th class="icon-col">#</th>
          <th>é›†çµä¸»</th>
          <th class="march-col">è¡Œè»(ç§’)</th>
          <th class="dep-col">å‡ºç™º(UTC)</th>
          <th class="pet-col">ãƒšãƒƒãƒˆ</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="icon-col">1</td>
          <td><input class="name-input" value="Player"></td>
          <td>
            <select class="march-sec">
              <option>13</option><option>30</option><option selected>34</option><option>45</option><option>60</option>
            </select>
          </td>
          <td class="dep">-</td>
          <td class="pet-col"><span class="pet-icon" role="button" aria-label="pet">âšªï¸</span></td>
        </tr>
        <tr>
          <td class="icon-col">2</td>
          <td><input class="name-input" value="Player"></td>
          <td>
            <select class="march-sec">
              <option>13</option><option selected>30</option><option>34</option><option>45</option><option>60</option>
            </select>
          </td>
          <td class="dep">-</td>
          <td class="pet-col"><span class="pet-icon" role="button" aria-label="pet">âšªï¸</span></td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- ã‚³ãƒ”ãƒ¼ -->
  <div class="card">
    <div class="row" style="justify-content:space-between">
      <strong>ã‚³ãƒ”ãƒ¼ç”¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</strong>
      <button id="make-copy" class="ghost">ç”Ÿæˆ</button>
    </div>
    <div id="copy" class="copy"></div>
  </div>

</div>

<script>
/* ===== UTCæ™‚è¨ˆï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ï¼‰ ===== */
function tickUTC(){
  const d=new Date();
  const hh=String(d.getUTCHours()).padStart(2,'0');
  const mm=String(d.getUTCMinutes()).padStart(2,'0');
  const ss=String(d.getUTCSeconds()).padStart(2,'0');
  document.getElementById('utc-now').textContent=`UTC ${hh}:${mm}:${ss}`;
}
setInterval(tickUTC,1000); tickUTC();

/* ===== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ===== */
function pad2(n){return String(n).padStart(2,'0')}
function fmtUTC(date){
  return `${pad2(date.getUTCHours())}:${pad2(date.getUTCMinutes())}:${pad2(date.getUTCSeconds())} UTC`;
}

/* ===== ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ ===== */
const modeSel=document.getElementById('mode-select');
const kabuse=document.getElementById('kabuse');
const chakudan=document.getElementById('chakudan');
const actionBtn=document.getElementById('action-btn');

modeSel.addEventListener('change',()=>{
  const m=modeSel.value;
  if(m==='kabuse'){
    kabuse.classList.remove('hidden');
    chakudan.classList.add('hidden');
    actionBtn.textContent='æ•µé›†çµãŒããŸï¼';
  }else{
    kabuse.classList.add('hidden');
    chakudan.classList.remove('hidden');
    actionBtn.textContent='è¨ˆç®—ã™ã‚‹';
  }
});

/* ===== ãƒšãƒƒãƒˆåˆ— è¡¨ç¤ºåˆ‡æ›¿ ===== */
const petVis=document.getElementById('pet-visibility');
function togglePetColumn(show){
  document.querySelectorAll('.pet-col, .table th.pet-col').forEach(el=>{
    el.style.display=show?'table-cell':'none';
  });
}
petVis.addEventListener('change',()=>togglePetColumn(petVis.checked));
togglePetColumn(petVis.checked);

/* ===== ãƒšãƒƒãƒˆï¼šã‚¯ãƒªãƒƒã‚¯ã§ âšªï¸â†’ğŸ¶ï¼ˆ2hï¼‰â†’âš«ï¸ã€‚ç™ºå‹•ä¸­ã¯è¡Œè‰²ã‚’æ·¡ã ===== */
const TWO_HOURS = 2*60*60; // ç§’
function attachPet(row){
  const icon=row.querySelector('.pet-icon');
  row.petState='idle';         // 'idle' | 'active' | 'ended'
  row.petRemain=0;
  row.petTimer=null;

  function setRowActive(on){ row.classList.toggle('row-active',on); }

  function toIdle(){
    row.petState='idle';
    icon.textContent='âšªï¸';
    setRowActive(false);
    if(row.petTimer){ clearInterval(row.petTimer); row.petTimer=null; }
    row.petRemain=0;
  }
  function toActive(){
    row.petState='active';
    icon.textContent='ğŸ¶';
    setRowActive(true);
    row.petRemain=TWO_HOURS;
    if(row.petTimer){ clearInterval(row.petTimer); }
    row.petTimer=setInterval(()=>{
      row.petRemain--;
      if(row.petRemain<=0){
        toEnded();
      }
    },1000);
  }
  function toEnded(){
    row.petState='ended';
    icon.textContent='âš«ï¸';
    setRowActive(false);
    if(row.petTimer){ clearInterval(row.petTimer); row.petTimer=null; }
    row.petRemain=0;
  }
  icon.addEventListener('click',()=>{
    if(row.petState==='idle'){ toActive(); }
    else if(row.petState==='active'){ toIdle(); }
    else if(row.petState==='ended'){ toIdle(); }
  });
}
document.querySelectorAll('#players tbody tr').forEach(attachPet);

/* ===== è¡Œã®è¿½åŠ ï¼å‰Šé™¤ ===== */
function renumber(){
  document.querySelectorAll('#players tbody tr').forEach((tr,i)=>{
    tr.querySelector('.icon-col').textContent = String(i+1);
  });
}
document.getElementById('add-row').addEventListener('click',()=>{
  const tbody=document.querySelector('#players tbody');
  const tr=document.createElement('tr');
  tr.innerHTML=`
    <td class="icon-col">#</td>
    <td><input class="name-input" value="Player"></td>
    <td>
      <select class="march-sec">
        <option>13</option><option>30</option><option selected>34</option><option>45</option><option>60</option>
      </select>
    </td>
    <td class="dep">-</td>
    <td class="pet-col"><span class="pet-icon" role="button" aria-label="pet">âšªï¸</span></td>
  `;
  tbody.appendChild(tr);
  attachPet(tr);
  renumber();
});
document.getElementById('del-row').addEventListener('click',()=>{
  const tbody=document.querySelector('#players tbody');
  if(tbody.rows.length>1){ tbody.deleteRow(tbody.rows.length-1); renumber(); }
});

/* ===== è¨ˆç®—ï¼ˆå‡ºç™ºæ™‚åˆ» & å…±é€šç€å¼¾ï¼‰ ===== */
function computeArriveUTC(){
  const now=new Date(); let arriveUtc;
  if(modeSel.value==='kabuse'){
    const after=parseInt(document.getElementById('after-sec').value,10);
    const rally=parseInt(document.getElementById('rally-min').value,10);
    arriveUtc=new Date(now.getTime()+after*1000+rally*60000);
  }else{
    const h=parseInt(document.getElementById('hh').value,10);
    const m=parseInt(document.getElementById('mm').value,10);
    const s=parseInt(document.getElementById('ss').value,10);
    const t=new Date();
    arriveUtc=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),h,m,s));
  }
  return arriveUtc;
}

actionBtn.addEventListener('click',()=>{
  const arriveUtc = computeArriveUTC();
  document.getElementById('arrive').textContent = fmtUTC(arriveUtc);

  document.querySelectorAll('#players tbody tr').forEach(row=>{
    const sec=parseInt(row.querySelector('.march-sec').value,10);
    const dep=new Date(arriveUtc.getTime()-sec*1000);
    row.querySelector('.dep').textContent = fmtUTC(dep);
  });
});

/* ===== ã‚³ãƒ”ãƒ¼æ–‡ ç”Ÿæˆï¼ˆæŒ‡å®šãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼‰ =====
  å…ˆé ­è¡Œï¼š
    ãƒ»è¢«ã›é›†çµãƒ¢ãƒ¼ãƒ‰ â†’ ã€Œ<é¸æŠåˆ†>åˆ†é›†çµãŠé¡˜ã„ã—ã¾ã™ï¼ğŸ™‡â€â™‚ï¸ğŸ™‡â€â™‚ï¸âœ¨ã€
    ãƒ»ç€å¼¾æ™‚åˆ»æŒ‡å®š   â†’ ã€Œâšªï¸åˆ†é›†çµãŠé¡˜ã„ã—ã¾ã™ï¼ğŸ™‡â€â™‚ï¸ğŸ™‡â€â™‚ï¸âœ¨ã€ï¼ˆâšªï¸å›ºå®šï¼‰
  æœ¬æ–‡ï¼šå„è¡Œã€Œ<åå‰>ã€€HH:MM:SS UTCã€
  æœ€çµ‚è¡Œï¼šã€Œç€å¼¾ï¼šHH:MM:SS UTCã€
*/
document.getElementById('make-copy').addEventListener('click',()=>{
  const arriveText = document.getElementById('arrive').textContent.trim() || '--:--:-- UTC';
  let head;
  if(modeSel.value==='kabuse'){
    const rally=document.getElementById('rally-min').value;
    head = `${rally}åˆ†é›†çµãŠé¡˜ã„ã—ã¾ã™ï¼ğŸ™‡â€â™‚ï¸ğŸ™‡â€â™‚ï¸âœ¨`;
  }else{
    head = `âšªï¸åˆ†é›†çµãŠé¡˜ã„ã—ã¾ã™ï¼ğŸ™‡â€â™‚ï¸ğŸ™‡â€â™‚ï¸âœ¨`;
  }

  const lines=[head,''];
  document.querySelectorAll('#players tbody tr').forEach(row=>{
    const name=(row.querySelector('.name-input').value||'Player').trim();
    const dep=row.querySelector('.dep').textContent.trim()||'-';
    lines.push(`${name}ã€€${dep}`);
  });
  lines.push('',`ç€å¼¾ï¼š${arriveText.replace(' UTC',' UTC')}`);

  document.getElementById('copy').textContent = lines.join('\n');
});
</script>
</body>
</html>