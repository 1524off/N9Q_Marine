<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>é›†çµæ™‚é–“è¨ˆç®—æ©Ÿï¼ˆArrival Marineï¼‰</title>
<style>
:root {
  --navy:#1565C0;
  --bg:#f7f9ff;
  --text:#1f2937;
  --line:#d1d5db;
}
body {
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans JP",sans-serif;
}
header {
  text-align:center;
  padding:14px 0 10px;
}
.clock {
  font-size:1.6rem;
  font-weight:800;
  color:var(--navy);
  font-family:"Roboto Mono",monospace;
}
main {
  max-width:680px;
  margin:0 auto;
  padding:10px;
}
.card {
  background:#fff;
  border:1px solid var(--line);
  border-radius:12px;
  padding:12px 14px;
  margin-bottom:12px;
  box-shadow:0 1px 3px rgba(0,0,0,0.05);
}
label {
  font-size:13px;
  color:#374151;
  font-weight:600;
}
select,input[type="text"] {
  font-size:15px;
  padding:8px 10px;
  border:1px solid var(--line);
  border-radius:8px;
  background:#f9fbff;
}
button {
  border:none;
  border-radius:8px;
  font-weight:700;
  cursor:pointer;
  transition:.2s;
}
.btn-primary {
  width:100%;
  background:var(--navy);
  color:#fff;
  font-size:1rem;
  padding:12px 0;
  margin-top:10px;
}
.btn-primary:active {transform:scale(.98);}
.small {
  font-size:18px;
  padding:6px 12px;
  margin:3px;
  background:#eef3ff;
  color:#0f4aa8;
}
#removeBtn {background:#fee2e2;color:#b91c1c;}
.row {
  display:flex;
  align-items:center;
  justify-content:center;
  flex-wrap:wrap;
  gap:6px;
}
#impactDisplay,#impactPreview,#impactPreviewNormal {
  text-align:center;
  color:var(--navy);
  font-weight:800;
  margin-top:10px;
  font-family:"Roboto Mono",monospace;
  font-size:1.2rem;
}
.table-wrap {overflow-x:auto;}
table {
  width:100%;
  border-collapse:collapse;
  text-align:center;
  font-size:14px;
}
th,td {border:1px solid var(--line);padding:8px;}
th {background:#eef3ff;color:#0f4aa8;}
tbody tr:nth-child(odd){background:#fafcff;}
tr.pet-on{background:#eaf3ff!important;}
#copyBox {
  background:#f5f8ff;
  border:1px solid var(--line);
  border-radius:10px;
  padding:10px;
  min-height:64px;
  white-space:pre-wrap;
  font-family:ui-monospace,Menlo,monospace;
  font-size:0.95rem;
  line-height:1.5;
}
footer {
  text-align:center;
  color:#9aa3b2;
  font-size:12px;
  padding:16px 0 24px;
}
</style>
</head>
<body>
<header>
  ç¾åœ¨æ™‚åˆ»ã€€<span id="utcClock" class="clock">--:--:--</span> UTC
</header>

<main>
<section class="card">
  <label>ãƒ¢ãƒ¼ãƒ‰é¸æŠï¼š</label>
  <select id="mode">
    <option value="normal" selected>è¢«ã›é›†çµ</option>
    <option value="reverse">ç€å¼¾æ™‚åˆ»æŒ‡å®š</option>
  </select>

  <!-- è¢«ã›é›†çµ -->
  <div id="normalBox" style="margin-top:10px;">
    <div class="row">
      <select id="prep"><option>30</option><option>60</option><option>90</option><option>120</option></select>
      <span>ç§’å¾Œã«</span>
      <select id="rally"><option>5</option><option>10</option><option>15</option></select>
      <span>åˆ†é›†çµ</span>
    </div>
    <button id="calcBtnNormal" class="btn-primary">æ•µé›†çµãŒããŸï¼</button>
    <p id="impactPreviewNormal">å…±é€šç€å¼¾äºˆå®šï¼š--:--:-- UTC</p>
  </div>

  <!-- ç€å¼¾æŒ‡å®š -->
  <div id="reverseBox" style="display:none;margin-top:10px;">
    <div class="row">
      <select id="hh"></select> : <select id="mm"></select> : <select id="ss"></select>
    </div>
    <p id="impactPreview">ç€å¼¾äºˆå®šæ™‚åˆ»ï¼š--:--:-- UTC</p>
    <div class="row">
      <span>åˆ†é›†çµ</span>
      <select id="rallyReverse"><option>5</option><option>10</option><option>15</option></select>
    </div>
    <button id="calcBtnReverse" class="btn-primary">è¨ˆç®—ã™ã‚‹</button>
  </div>

  <div class="row" style="justify-content:space-between;margin-top:8px;">
    <div>
      <button id="addBtn" class="small">ï¼‹</button>
      <button id="removeBtn" class="small">âˆ’</button>
    </div>
    <label><input type="checkbox" id="showPet" checked> ãƒšãƒƒãƒˆè¡¨ç¤º</label>
  </div>
</section>

<section class="card table-wrap">
  <table id="tbl">
    <thead>
      <tr><th>ğŸ¶</th><th>é›†çµä¸»</th><th>è¡Œè»</th><th>å‡ºç™º(UTC)</th><th>æ®‹ã‚ŠğŸ¾</th></tr>
    </thead>
    <tbody id="tbody">
      <tr>
        <td><input type="checkbox" class="pet"></td>
        <td><input type="text" placeholder="ä¾‹ï¼šMarine"></td>
        <td><select class="march"></select></td>
        <td>-</td><td class="pet-time">-</td>
      </tr>
    </tbody>
  </table>
</section>

<section class="card">
  <label>ã‚³ãƒ”ãƒ¼ç”¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</label>
  <div id="copyBox">ï¼ˆçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰</div>
  <button id="copyBtn" class="btn-primary">ã‚³ãƒ”ãƒ¼</button>
</section>
</main>

<footer>Â© 1524 Off_Marine</footer>

<script>
// ===== æ™‚è¨ˆ =====
const pad=n=>String(n).padStart(2,"0");
const fmtUTC=d=>`${pad(d.getUTCHours())}:${pad(d.getUTCMinutes())}:${pad(d.getUTCSeconds())}`;
const nowUTC=()=>new Date();
setInterval(()=>{document.getElementById("utcClock").textContent=fmtUTC(nowUTC());},1000);

// ===== è¡Œè»ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ =====
function fillMarch(sel){
  for(let s=34;s<=180;s++){
    const m=Math.floor(s/60),sec=s%60;
    const label=(m?`${m}åˆ†`:"")+`${sec}ç§’`;
    sel.add(new Option(label,s));
  }
}
document.querySelectorAll(".march").forEach(fillMarch);

// ===== ç€å¼¾æŒ‡å®šãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ =====
(function(){
  const hh=document.getElementById("hh"),mm=document.getElementById("mm"),ss=document.getElementById("ss");
  for(let h=12;h<=16;h++)hh.add(new Option(pad(h),h));
  for(let m=0;m<60;m+=2)mm.add(new Option(pad(m),m));
  for(let s=0;s<60;s+=10)ss.add(new Option(pad(s),s));
  hh.value=12;mm.value=0;ss.value=0;
})();

// ===== ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ =====
const modeSel=document.getElementById("mode");
modeSel.onchange=()=>{const rev=modeSel.value==="reverse";
document.getElementById("normalBox").style.display=rev?"none":"block";
document.getElementById("reverseBox").style.display=rev?"block":"none";};

// ===== ãƒšãƒƒãƒˆ =====
const PET_MS=2*60*60*1000;
function setPetHandlers(){
  document.querySelectorAll(".pet").forEach(cb=>{
    cb.onchange=()=>{
      const row=cb.closest("tr");
      const cell=row.querySelector(".pet-time");
      if(cb.checked){
        row.dataset.petEnd=(Date.now()+PET_MS).toString();
        row.classList.add("pet-on");
      }else{
        delete row.dataset.petEnd;
        row.classList.remove("pet-on");
        cell.textContent="-";
      }
    };
  });
}
setPetHandlers();

// ãƒšãƒƒãƒˆæ®‹ã‚Šæ™‚é–“æ›´æ–°
setInterval(()=>{
  document.querySelectorAll("#tbody tr").forEach(row=>{
    if(!row.dataset.petEnd)return;
    const diff=row.dataset.petEnd-Date.now();
    const cell=row.querySelector(".pet-time");
    if(diff<=0){
      row.classList.remove("pet-on");
      cell.textContent="âš« çµ‚äº†";
      delete row.dataset.petEnd;
      return;
    }
    const h=Math.floor(diff/3600000),m=Math.floor((diff%3600000)/60000),s=Math.floor((diff%60000)/1000);
    cell.textContent=`ğŸ¶ ${h}:${pad(m)}:${pad(s)}`;
  });
},1000);

// ===== ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ =====
function updateImpactPreview(){
  const hh=pad(document.getElementById('hh').value);
  const mm=pad(document.getElementById('mm').value);
  const ss=pad(document.getElementById('ss').value);
  document.getElementById('impactPreview').textContent=`ç€å¼¾äºˆå®šæ™‚åˆ»ï¼š${hh}:${mm}:${ss} UTC`;
}
['hh','mm','ss'].forEach(id=>{
  document.getElementById(id).addEventListener('change',updateImpactPreview);
});
function updateNormalPreview(){
  const prep=+document.getElementById("prep").value;
  const rally=+document.getElementById("rally").value;
  const now=nowUTC();
  const impact=new Date(now.getTime()+prep*1000+rally*60*1000);
  document.getElementById("impactPreviewNormal").textContent=`å…±é€šç€å¼¾äºˆå®šï¼š${fmtUTC(impact)} UTC`;
}
['prep','rally'].forEach(id=>{
  document.getElementById(id).addEventListener('change',updateNormalPreview);
});

// ===== è¡Œè¿½åŠ /å‰Šé™¤ =====
document.getElementById("addBtn").onclick=()=>{
  const tr=document.createElement("tr");
  tr.innerHTML=`<td><input type="checkbox" class="pet"></td><td><input type="text" placeholder="åå‰"></td><td><select class="march"></select></td><td>-</td><td class="pet-time">-</td>`;
  document.getElementById("tbody").appendChild(tr);
  fillMarch(tr.querySelector(".march"));
  setPetHandlers();
};
document.getElementById("removeBtn").onclick=()=>{
  const rows=document.querySelectorAll("#tbody tr");
  if(rows.length>1)rows[rows.length-1].remove();
};

// ===== è¨ˆç®— =====
function computeNormal(){
  const rally=+document.getElementById("rally").value,prep=+document.getElementById("prep").value;
  const rows=[...document.querySelectorAll("#tbody tr")].map(r=>({r,name:r.querySelector("input[type=text]").value||"Player",march:+r.querySelector(".march").value}));
  const now=nowUTC();
  const base=new Date(now.getTime()+prep*1000);
  const max=Math.max(...rows.map(x=>x.march),0);
  const impact=new Date(base.getTime()+max*1000+rally*60*1000);
  rows.forEach(x=>{const depart=new Date(base.getTime()+(max-x.march)*1000);x.r.children[3].textContent=`${fmtUTC(depart)} UTC`;x.depart=depart;});
  document.getElementById("impactPreviewNormal").textContent=`å…±é€šç€å¼¾äºˆå®šï¼š${fmtUTC(impact)} UTC`;
  renderCopy(rally,rows,impact);
}
function computeReverse(){
  const rally=+document.getElementById("rallyReverse").value;
  const H=+document.getElementById("hh").value,M=+document.getElementById("mm").value,S=+document.getElementById("ss").value;
  const target=new Date(nowUTC());target.setUTCHours(H,M,S,0);
  const rows=[...document.querySelectorAll("#tbody tr")].map(r=>({r,name:r.querySelector("input[type=text]").value||"Player",march:+r.querySelector(".march").value}));
  rows.forEach(x=>{
    const depart=new Date(target.getTime()-rally*60*1000-x.march*1000);
    x.r.children[3].textContent=`${fmtUTC(depart)} UTC`;x.depart=depart;
  });
  renderCopy(rally,rows,target);
}
document.getElementById("calcBtnNormal").onclick=computeNormal;
document.getElementById("calcBtnReverse").onclick=computeReverse;

// ===== ã‚³ãƒ”ãƒ¼ =====
function renderCopy(rally,rows,impact){
  const lines=[`${rally}åˆ†é›†çµãŠé¡˜ã„ã—ã¾ã™ï¼ğŸ™‡â€â™‚ï¸âœ¨`,''];
  rows.forEach(x=>{
    const icon=x.r.querySelector('.pet').checked?'ğŸ¶':'âšª';
    lines.push(`${icon}${x.name}ã€€${fmtUTC(x.depart)} UTC`);
  });
  lines.push('',`ç€å¼¾ï¼š${fmtUTC(impact)} UTC`);
  document.getElementById("copyBox").textContent=lines.join("\n");
}
document.getElementById("copyBtn").onclick=async()=>{
  const text=document.getElementById("copyBox").textContent;
  try{await navigator.clipboard.writeText(text);alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");}
  catch{const ta=document.createElement("textarea");ta.value=text;document.body.appendChild(ta);
    ta.select();document.execCommand("copy");ta.remove();alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");}
};
</script>
</body>
</html>